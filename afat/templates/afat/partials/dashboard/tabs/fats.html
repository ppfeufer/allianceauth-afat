{% load evelinks %}
{% load i18n %}

<script>
    let characters = [];
</script>

<div id="tab-fats" class="tab-pane fade show active card card-default border-0" role="tabpanel" aria-labelledby="tab-fats">
    <div class="card-body">
        <h4>
            {% translate "Your most recent FATs" %}
        </h4>

        <p>{% translate "Only characters that have recent FATs are shown. <small>(latest 10 FATs per character)</small>" %}</p>

        {% if characters %}
            <ul class="nav nav-pills">
                {% for character in characters %}
                    <li class="nav-item afat-character-tab text-center">
                        <script>
                            characters.push({
                                charId: {{ character.character_id }},
                                charName: '{{ character.character_name }}'
                            })
                        </script>

                        <a
                            class="nav-link{% if forloop.first %} active{% endif %}"
                            id="tab-{{ character.character_id }}"
                            data-bs-toggle="tab"
                            href="#content-{{ character.character_id }}"
                            role="tab"
                            aria-controls="content-{{ character.character_id }}"
                            aria-selected="true"
                        >
                            <img class="rounded" src="{{ character.character_id|character_portrait_url:64 }}" alt="{{ character.character_name }}" width="48px" height="48px"><br>
                            <span id="afat-eve-character-id-{{ character.character_id }}">{{ character.character_name }}</span>
                        </a>
                    </li>
                {% endfor %}
            </ul>

            <div class="tab-content mt-3 border-top">
                {% for character in characters %}
                    <div id="content-{{ character.character_id }}" class="tab-pane fade card-default{% if forloop.first %} show active{% endif %}">
                        <div class="card-body">
                            <table class="table table-striped table-hover w-100" id="recent-fats-character-{{ character.character_id }}">
                                <thead>
                                    <tr>
                                        <th>{% translate "Fleet name" %}</th>
                                        <th>{% translate "Fleet type" %}</th>
                                        <th>{% translate "Location" %}</th>
                                        <th>{% translate "Ship" %}</th>
                                        <th>{% translate "Eve time" %}</th>
                                    </tr>
                                </thead>

                                <tbody></tbody>

                                <tfoot>
                                    <tr>
                                        <td colspan="{% if perms.afat.manage_afat %}5{% else %}4{% endif %}">
                                            {% include "afat/partials/fatlinks/fatlink_list_legend.html" %}
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="alert alert-warning" role="alert">
                <p>
                    {% translate "No recent FAT activity registered for any of your characters." %}
                </p>
            </div>
        {% endif %}
    </div>
</div>
